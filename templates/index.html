<!DOCTYPE html>
<html>
    <head>
        <title>My Calendar</title>
        <style>
            .calendar-grid{
                display: grid;
                grid-template-columns: repeat(7, 1fr); /*7列に並べる*/
                gap: 10px;
                max-width: 500px;
            }
            .day-box{
                border: 1px solid #ccc;
                padding: 10px;
                text-align: center;
            }
            .sat{
                color: blue;
            }
            .sun-holiday{
                color: red;
            }
            #modal{ /*スケジュール入力用のポップアップ（最初は隠しておく）*/
                display: none;
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: white; border: 2px solid #333; padding: 20px; z-index: 1000;
            }
            #overlay{ /*背景を暗くする*/
                display: none;
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background-color: rgba(0,0,0,0,5); z-index: 999;
            }
        </style>
    </head>

    
    <body>
        <!--　↓Python側から送ったデータをはめ込むことができる　-->
        <h1>{{ title }}</h1>
        
        <div class="calendar-grid">
            <!-- 曜日の表示 -->
            {% for w_day in week_days %}
                <!-- loop.index0は、forループの中で「今が何回目か」を0から数えてくれる変数。0(月) ~ 6(日)となる -->
                <div class="day-box {% if loop.index0 == 5 %}sat{% elif loop.index0 == 6 %}sun-holiday{% endif %}">
                    {{ w_day }}
                </div>
            {% endfor %}

            <!-- 日付の表示 -->
            {% for week in cal %}
                {% for day in week %}

                    <!-- まず「祝日ではない」と決めておく -->
                    {% set is_holiday = False %}
                    {% set holiday_name = "" %}

                    <!-- dayが0から大きい場合(正しい日付)のみ計算を行う -->
                    <!-- その日が祝日かどうかのチェック(2026-02-xxの形式で) -->
                    {% if day != 0 %}
                        {% set date_str = "2026-02-%02d" | format(day) %}
                        {% if date_str in jp_holidays %}
                            {% set is_holiday = True %}
                            {% set holiday_name = jp_holidays.get(date_str) %}
                        {% endif %}
                    {% endif %}


                    <div class="day-box" style="cursor: pointer;" onclick="openModal('{{ day }}')">
                        <span class="{% if loop.index0 == 5 %}sat{% elif loop.index0 == 6 %}sun-holiday{% elif is_holiday %}sun-holiday{% endif %}">
                            {% if day != 0 %}
                                {{ day }}
                            {% endif %}
                        </span>

                        <!-- 日付の部分にスケジュールを表示させるための空の箱を用意 -->
                        <div id="schedule-{{ day }}" style="font-size: 0.7em; color: #555; margin-top: 5px;"></div>

                        <!-- 祝日名の表示 -->
                        <!--
                        {% if is_holiday %}
                            <div style="font-size: 0.6em; color: red;">{{ holiday_name }}</div>
                        {% endif %}
                        -->
                    </div>
                {% endfor %}
            {% endfor %}
        </div>

        <div id="overlay"></div>
        <div id="modal">
            <h3 id="modal-date"></h3>
            <input type="text" id="schedule-input" placeholder="予定を入力...">
            <button onclick="saveSchedule()">保存</button>
            <button onclick="closeModal()">閉じる</button>
        </div>

        
        <script>
            const modal = document.getElementById('modal');
            const overlay = document.getElementById('overlay');
            const modalDate = document.getElementById('modal-date');


            //今どの日付を編集しているかを覚えておくための変数
            let currentEditingDay = 0;

            // Modalを開く
            function openModal(day) {
                if (day === '0') return
                currentEditingDay = day; //ここで記録
                modalDate.innerText = "2月 " + day + " 日の予定";
                modal.style.display = 'block';
                overlay.style.display = 'block';
            }

            //Modalを閉じる
            function closeModal() {
                modal.style.display = 'none';
                overlay.style.display = 'none';
            }

            //保存ボタン（現段階ではアラートを出すのみ）
            function saveSchedule() {
                //入力された文字の読み取り
                const text = document.getElementById('schedule-input').value;
                
                //今何日を編集しているかを取得
                const day = currentEditingDay;

                if (text) {
                    //その日のスケジュール表示用の箱を見つけて、文字を入れる
                    const scheduleBox = document.getElementById('schedule-' + day);
                    scheduleBox.innerText = text;
                }

                //入力欄を空にして閉じる
                document.getElementById('schedule-input').value = "";
                closeModal();
            }            
        </script>
    </body>
</html>